# スマートフォンとSORACOM FunkとAWSサービスを用いた画像認識サービスを構築する

# はじめに

当コンテンツは、エッジデバイスとしてスマートフォン、クラウドサービスとしてAWSを利用し、エッジデバイスとクラウド間とのデータ連携とAWSサービスを利用した画像認識を体験し、IoT/画像認識システムの基礎的な技術の習得を目指す方向けのハンズオン(体験学習)コンテンツです。

また、スマートフォンとAWSサービスの接続には、クラウドファンクションをSORACOM経由で呼び出すことの出来るSORACOM Funkというサービスを使用します。

SORACOM Funkを使用することで、デバイス側で複雑なデータ処理をすることなく、クラウド側の膨大なリソースを使って画像認識処理を実行させることが出来ます。

## 全体のアーキテクチャ

今回のコンテンツ内で構築するIoTシステムの全体像です。

![全体アーキテクチャ図](https://s3.amazonaws.com/docs.iot.kyoto/img/SoracomUG-Reko-Handson/architecture_overall.png)

### 今回のアーキテクチャの3つの大きなポイント

### ポイント1. SORACOM Funkを使ったクラウドへの処理のオフロード

- SORACOM Funk経由でのAWS Lambdaの実行
- AWS認証情報をSORACOM側で管理
- デバイス側の低電力消費化
- デバイス側処理をシンプルにする
- デバイス側の性能で捌けない複雑な処理をクラウド側で処理

### ポイント2. Amazon Rekognitionを使った人物認証

- AWSの画像分析サービス「**[Amazon Rekognition](https://aws.amazon.com/jp/rekognition/)**」を使って、デバイスのカメラで取得した画像の分析や、画像に写っている人物が事前登録済みの人物かどうかの判定を行います

### ポイント3. AWS Amplifyを使った静的コンテンツのデプロイ

- サーバーレスウェブアプリケーションをデプロイおよびホストするためのAWSサービス「**[AWS Amplify Console](https://aws.amazon.com/jp/amplify/console/)**」を使って、スマートフォンで表示するためのWEBアプリケーションのデプロイ・ホスティングを行います

以上を通して、エッジ側で取得した画像データを使ったクラウド側の画像認識サービス活用のノウハウを学びます。

## ハンズオンの前提条件

このハンズオンを行う上で必要な環境やスキルです。
下記条件を満たさない場合、うまくハンズオンが進められない場合がありますので、あらかじめご了承ください。

- Admin権限で利用できるAWSアカウントを所有していること
- AWSコンソールヘのログインや一般的な操作が可能であること
- Pythonで記述されたプログラムの読み書きができること
- JavaScriptで記述されたプログラムの読み書きができること
- 基本的なLinuxコマンドライン操作ができること
- ローカルPCのWebブラウザとして「Chrome」が利用可能であること

## ハンズオンの進め方

ハンズオンは、内容によって４つのステップに分割しています。
当ポータルサイトから各ステップの記事を新規タブで開いて、１つずつ進めてください。

またスマートフォン側で動かすVue.js(JavaScript)コードやLambdaのPythonコードのサンプルソースは[GitHubのリポジトリ](https://github.com/IoTkyoto/soracom-ug-reko-handson)で公開しています。

コンテンツ内でもご案内しますが、実装が必要なステップではこちらのサンプルソースをご活用ください。  
コンテンツ内には実装に関わるヒントも掲載していますので、自力でコーディング出来る方は是非チャレンジしてみましょう。

# ステップ1. 環境準備

今回のハンズオンでは、エッジデバイスであるスマートフォンと、クラウド環境の構築やその他必要な作業を行うためのローカルPCが必要です。
ハンズオンを進めるにあたって必要な準備作業について説明します。

**以下のコンテンツを開き、ステップ1を進めてください**  
[ステップ１へ](https://iotkyoto.github.io/soracom-ug-reko-handson/step1)

# ステップ2. 顔認識用のコレクションを作成する

ステップ2では、画像に写っている人物を特定するために必要なコレクションを作成します。

AWS Rekognitionサービスには、事前登録済みの情報（コレクション）を使って、画像内に誰が写っているのかを特定する機能があります。

まずは、画像のアップロード先として「[**Amazon S3（以下、S3）**](https://aws.amazon.com/jp/s3)」にバケットを作成し、登録したい人物が１人で写っている画像をAWSコンソールからアップロードします。

AWSのCLI(コマンド・ライン・インターフェース)ツールを使って、「**[Amazon Rekognition（以下、Rekognition）](https://aws.amazon.com/jp/rekognition/)**」の「コレクション」を作成し、認識対象となる顔を登録します。


**以下のコンテンツを開き、ステップ2を進めてください**  
[ステップ２へ](https://iotkyoto.github.io/soracom-ug-reko-handson/step2)

# ステップ3. 顔認証用のファンクションを作成しSORACOM Funk経由で呼び出す

ステップ3では、前ステップでS3バケットにアップロードされた画像を分析し「事前登録済みの人物が写っているかを判定し、写っている場合は誰なのかを判定する」という機能を持ったクラウドファンクションを作成し、デバイス側からSORACOM Funk経由で呼び出す仕組みを構築します。

**以下のコンテンツを開き、ステップ3を進めてください**  
[ステップ３へ](https://iotkyoto.github.io/soracom-ug-reko-handson/step3)


# ステップ4. 後片付け

ご利用いただいたAWSの各種サービスには無料利用枠がございますが、無料利用枠を超えた場合は従量課金が発生します。

ハンズオンを行い、環境が不要となれば各種リソースを削除することを推奨します。

**以下のコンテンツを開き、ステップ４を進めてください**  
[ステップ４へ](https://iotkyoto.github.io/soracom-ug-reko-handson/step4)

# さいごに









